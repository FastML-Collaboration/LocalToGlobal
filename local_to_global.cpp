#include "local_to_global.h"

const coords_t mapL0[] = {
  { -12.7290,  3.1565,   0.1374 },
  {  -9.7149,  3.1484,   0.1383 },
  {  -6.7010,  3.1434,   0.1396 },
  {  -3.6867,  3.1396,   0.1413 },
  {  -0.6721,  3.1363,   0.1428 },
  {   2.3420,  3.1318,   0.1444 },
  {   5.3548,  3.1291,   0.1461 },
  {   8.3703,  3.1252,   0.1479 },
  {  11.3815,  3.1187,   0.1492 },
  { -12.7251,  2.9323,   0.5659 },
  {  -9.7100,  2.9322,   0.5681 },
  {  -6.6959,  2.9314,   0.5708 },
  {  -3.6820,  2.9309,   0.5737 },
  {  -0.6669,  2.9304,   0.5768 },
  {   2.3490,  2.9287,   0.5792 },
  {   5.3627,  2.9271,   0.5812 },
  {   8.3750,  2.9241,   0.5835 },
  {  11.3900,  2.9168,   0.5846 },
  { -12.7152,  2.6141,   1.0238 },
  {  -9.6996,  2.6141,   1.0263 },
  {  -6.6850,  2.6162,   1.0295 },
  {  -3.6710,  2.6184,   1.0330 },
  {  -0.6560,  2.6208,   1.0365 },
  {   2.3586,  2.6231,   1.0403 },
  {   5.3733,  2.6231,   1.0434 },
  {   8.3873,  2.6237,   1.0465 },
  {  11.4021,  2.6235,   1.0489 },
  { -12.6973,  2.2882,   1.5799 },
  {  -9.6840,  2.2846,   1.5799 },
  {  -6.6700,  2.2809,   1.5792 },
  {  -3.6547,  2.2765,   1.5788 },
  {  -0.6393,  2.2721,   1.5784 },
  {   2.3754,  2.2673,   1.5781 },
  {   5.3891,  2.2639,   1.5775 },
  {   8.4040,  2.2608,   1.5769 },
  {  11.4180,  2.2598,   1.5762 },
  { -12.6883,  1.9759,   2.1857 },
  {  -9.6773,  1.9747,   2.1826 },
  {  -6.6631,  1.9735,   2.1805 },
  {  -3.6487,  1.9743,   2.1792 },
  {  -0.6350,  1.9759,   2.1789 },
  {   2.3781,  1.9774,   2.1790 },
  {   5.3929,  1.9795,   2.1789 },
  {   8.4061,  1.9839,   2.1794 },
  {  11.4205,  1.9877,   2.1806 },
  { -12.6917,  1.8455,   2.8702 },
  {  -9.6766,  1.8457,   2.8681 },
  {  -6.6633,  1.8464,   2.8666 },
  {  -3.6488,  1.8485,   2.8653 },
  {  -0.6351,  1.8504,   2.8643 },
  {   2.3789,  1.8531,   2.8637 },
  {   5.3931,  1.8553,   2.8628 },
  {   8.4062,  1.8576,   2.8619 },
  {  11.4205,  1.8617,   2.8612 },
  { -12.6829,  1.9382,  -2.7225 },
  {  -9.6692,  1.9325,  -2.7248 },
  {  -6.6561,  1.9298,  -2.7274 },
  {  -3.6428,  1.9306,  -2.7299 },
  {  -0.6291,  1.9331,  -2.7320 },
  {   2.3847,  1.9379,  -2.7338 },
  {   5.3986,  1.9443,  -2.7355 },
  {   8.4121,  1.9512,  -2.7371 },
  {  11.4260,  1.9582,  -2.7383 },
  { -12.7540,  2.1139,  -2.1545 },
  {  -9.6696,  2.1878,  -2.1051 },
  {  -6.6556,  2.1858,  -2.1070 },
  {  -3.6420,  2.1865,  -2.1095 },
  {  -0.6290,  2.1887,  -2.1125 },
  {   2.3853,  2.1913,  -2.1145 },
  {   5.3991,  2.1948,  -2.1174 },
  {   8.4136,  2.1989,  -2.1200 },
  {  11.4283,  2.2025,  -2.1226 },
  { -12.6775,  2.5115,  -1.5642 },
  {  -9.6653,  2.5100,  -1.5660 },
  {  -6.6520,  2.5083,  -1.5676 },
  {  -3.6383,  2.5086,  -1.5700 },
  {  -0.6247,  2.5098,  -1.5723 },
  {   2.3898,  2.5115,  -1.5747 },
  {   5.4039,  2.5138,  -1.5773 },
  {   8.4185,  2.5152,  -1.5803 },
  {  11.4331,  2.5155,  -1.5827 },
  { -12.7466,  2.8733,  -1.0855 },
  {  -9.7309,  2.8719,  -1.0858 },
  {  -6.7172,  2.8689,  -1.0863 },
  {  -3.7018,  2.8639,  -1.0869 },
  {  -0.6877,  2.8577,  -1.0873 },
  {   2.3268,  2.8502,  -1.0871 },
  {   5.3409,  2.8433,  -1.0877 },
  {   8.3541,  2.8363,  -1.0883 },
  {  11.3688,  2.8322,  -1.0882 },
  { -12.7466,  3.1009,  -0.6550 },
  {  -9.7320,  3.0953,  -0.6550 },
  {  -6.7180,  3.0900,  -0.6547 },
  {  -3.7020,  3.0849,  -0.6540 },
  {  -0.6871,  3.0785,  -0.6533 },
  {   2.3276,  3.0726,  -0.6525 },
  {   5.3411,  3.0680,  -0.6520 },
  {   8.3554,  3.0614,  -0.6511 },
  {  11.3700,  3.0589,  -0.6508 },
  { -12.7375,  3.1917,  -0.2403 },
  {  -9.7237,  3.1881,  -0.2398 },
  {  -6.7092,  3.1833,  -0.2389 },
  {  -3.6945,  3.1800,  -0.2376 },
  {  -0.6796,  3.1748,  -0.2359 },
  {   2.3362,  3.1716,  -0.2339 },
  {   5.3497,  3.1676,  -0.2322 },
  {   8.3634,  3.1641,  -0.2311 },
  {  11.3775,  3.1623,  -0.2302 }
};

const coords_t mapL1[] = {
  { -12.7551,  3.9372,   0.1316 },
  {  -9.7417,  3.9384,   0.1321 },
  {  -6.7275,  3.9397,   0.1324 },
  {  -3.7128,  3.9408,   0.1325 },
  {  -0.6989,  3.9424,   0.1323 },
  {   2.3156,  3.9435,   0.1323 },
  {   5.3301,  3.9431,   0.1321 },
  {   8.3338,  3.8705,   0.1474 },
  {  11.3578,  3.9441,   0.1318 },
  { -12.7608,  3.7885,   0.4680 },
  {  -9.7471,  3.7878,   0.4678 },
  {  -6.7328,  3.7872,   0.4673 },
  {  -3.7189,  3.7875,   0.4669 },
  {  -0.7042,  3.7878,   0.4666 },
  {   2.3103,  3.7889,   0.4665 },
  {   5.3252,  3.7907,   0.4666 },
  {   8.2696,  3.7502,   0.4900 },
  {  11.3540,  3.7983,   0.4673 },
  { -12.7489,  3.5858,   0.8186 },
  {  -9.7343,  3.5863,   0.8186 },
  {  -6.7203,  3.5868,   0.8185 },
  {  -3.7066,  3.5876,   0.8184 },
  {  -0.6922,  3.5892,   0.8186 },
  {   2.3221,  3.5911,   0.8186 },
  {   5.3367,  3.5946,   0.8183 },
  {   8.3515,  3.5977,   0.8178 },
  {  11.3666,  3.6017,   0.8173 },
  { -12.7651,  3.3359,   1.1909 },
  {  -9.7509,  3.3396,   1.1909 },
  {  -6.7356,  3.3431,   1.1903 },
  {  -3.7212,  3.3473,   1.1896 },
  {  -0.7067,  3.3518,   1.1887 },
  {   2.3076,  3.3553,   1.1878 },
  {   5.3221,  3.3575,   1.1872 },
  {   8.3369,  3.3597,   1.1864 },
  {  11.3516,  3.3611,   1.1857 },
  { -12.6963,  3.1202,   1.5827 },
  {  -9.6816,  3.1181,   1.5832 },
  {  -6.6679,  3.1164,   1.5834 },
  {  -3.6538,  3.1143,   1.5837 },
  {  -0.6396,  3.1130,   1.5842 },
  {   2.3743,  3.1120,   1.5851 },
  {   5.3881,  3.1123,   1.5861 },
  {   8.4019,  3.1110,   1.5869 },
  {  11.4161,  3.1114,   1.5873 },
  { -12.7113,  2.8390,   2.0215 },
  {  -9.6909,  2.8932,   2.0101 },
  {  -6.6749,  2.8960,   2.0107 },
  {  -3.6605,  2.8970,   2.0115 },
  {  -0.6462,  2.8975,   2.0120 },
  {   2.3686,  2.8983,   2.0125 },
  {   5.3837,  2.8981,   2.0128 },
  {   8.3979,  2.8988,   2.0130 },
  {  11.4119,  2.8974,   2.0131 },
  { -12.6976,  2.7383,   2.4673 },
  {  -9.6828,  2.7402,   2.4682 },
  {  -6.6681,  2.7409,   2.4687 },
  {  -3.6533,  2.7404,   2.4695 },
  {  -0.6382,  2.7394,   2.4701 },
  {   2.3772,  2.7384,   2.4706 },
  {   5.3924,  2.7371,   2.4710 },
  {   8.4068,  2.7366,   2.4710 },
  {  11.4207,  2.7354,   2.4713 },
  { -12.7064,  2.6770,   2.9445 },
  {  -9.6898,  2.6769,   2.9457 },
  {  -6.6744,  2.6788,   2.9469 },
  {  -3.6575,  2.6800,   2.9480 },
  {  -0.6416,  2.6803,   2.9487 },
  {   2.3745,  2.6798,   2.9495 },
  {   5.3902,  2.6784,   2.9502 },
  {   8.4049,  2.6762,   2.9507 },
  {  11.4187,  2.6747,   2.9513 },
  { -12.6987,  2.7441,  -2.8616 },
  {  -9.6836,  2.7466,  -2.8609 },
  {  -6.6691,  2.7479,  -2.8600 },
  {  -3.6548,  2.7484,  -2.8592 },
  {  -0.6400,  2.7476,  -2.8584 },
  {   2.3742,  2.7461,  -2.8577 },
  {   5.3887,  2.7449,  -2.8570 },
  {   8.4031,  2.7436,  -2.8561 },
  {  11.4178,  2.7432,  -2.8550 },
  { -12.6989,  2.9744,  -2.3834 },
  {  -9.6709,  2.8870,  -2.4041 },
  {  -6.6558,  2.8903,  -2.4029 },
  {  -3.6411,  2.8921,  -2.4016 },
  {  -0.6265,  2.8942,  -2.4003 },
  {   2.3883,  2.8941,  -2.3987 },
  {   5.4030,  2.8931,  -2.3974 },
  {   8.4176,  2.8912,  -2.3961 },
  {  11.4325,  2.8877,  -2.3949 },
  { -12.6841,  3.0703,  -1.9764 },
  {  -9.6700,  3.0740,  -1.9755 },
  {  -6.6546,  3.0756,  -1.9741 },
  {  -3.6391,  3.0770,  -1.9728 },
  {  -0.6243,  3.0787,  -1.9713 },
  {   2.3915,  3.0803,  -1.9696 },
  {   5.4062,  3.0825,  -1.9681 },
  {   8.4205,  3.0830,  -1.9667 },
  {  11.4359,  3.0815,  -1.9652 },
  { -12.6520,  3.3300,  -1.5801 },
  {  -9.6821,  3.3447,  -1.5783 },
  {  -6.6676,  3.3466,  -1.5770 },
  {  -3.6529,  3.3491,  -1.5755 },
  {  -0.6381,  3.3505,  -1.5740 },
  {   2.3783,  3.3521,  -1.5722 },
  {   5.3940,  3.3526,  -1.5709 },
  {   8.4096,  3.3520,  -1.5697 },
  {  11.4246,  3.3517,  -1.5686 },
  { -12.7623,  3.6009,  -1.1913 },
  {  -9.7477,  3.6002,  -1.1911 },
  {  -6.7330,  3.5996,  -1.1910 },
  {  -3.7171,  3.5988,  -1.1907 },
  {  -0.7025,  3.5976,  -1.1906 },
  {   2.3131,  3.5971,  -1.1903 },
  {   5.3277,  3.5972,  -1.1900 },
  {   8.3415,  3.5961,  -1.1896 },
  {  11.3574,  3.5976,  -1.1892 },
  { -12.7576,  3.7915,  -0.8470 },
  {  -9.7431,  3.7938,  -0.8467 },
  {  -6.7287,  3.7973,  -0.8462 },
  {  -3.7135,  3.7992,  -0.8455 },
  {  -0.6979,  3.8010,  -0.8446 },
  {   2.3173,  3.8013,  -0.8438 },
  {   5.3317,  3.8012,  -0.8429 },
  {   8.3469,  3.7999,  -0.8420 },
  {  11.3627,  3.7989,  -0.8414 },
  { -12.7793,  3.9050,  -0.5098 },
  {  -9.7653,  3.9070,  -0.5089 },
  {  -6.7503,  3.9080,  -0.5081 },
  {  -3.7348,  3.9087,  -0.5075 },
  {  -0.7190,  3.9101,  -0.5073 },
  {   2.2966,  3.9117,  -0.5069 },
  {   5.3117,  3.9121,  -0.5065 },
  {   8.3272,  3.9136,  -0.5059 },
  {  11.3433,  3.9144,  -0.5056 },
  { -12.7737,  3.9389,  -0.1793 },
  {  -9.7591,  3.9394,  -0.1788 },
  {  -6.7437,  3.9411,  -0.1781 },
  {  -3.7285,  3.9434,  -0.1777 },
  {  -0.7126,  3.9463,  -0.1772 },
  {   2.3041,  3.9484,  -0.1765 },
  {   5.3201,  3.9507,  -0.1761 },
  {   8.3358,  3.9520,  -0.1756 },
  {  11.3519,  3.9533,  -0.1754 }
};

const coords_t mapL2[] = {
  { -12.7608,  4.7284,   0.1072 },
  {  -9.7468,  4.7293,   0.1076 },
  {  -6.7317,  4.7320,   0.1078 },
  {  -3.7171,  4.7341,   0.1080 },
  {  -0.7035,  4.7370,   0.1081 },
  {   2.3112,  4.7394,   0.1081 },
  {   5.3270,  4.7428,   0.1081 },
  {   8.3465,  4.7489,   0.1083 },
  {  11.3564,  4.7558,   0.1078 },
  { -12.7587,  4.6292,   0.3851 },
  {  -9.7445,  4.6299,   0.3846 },
  {  -6.7304,  4.6311,   0.3841 },
  {  -3.7162,  4.6341,   0.3837 },
  {  -0.7019,  4.6369,   0.3834 },
  {   2.3116,  4.6406,   0.3833 },
  {   5.3274,  4.6438,   0.3830 },
  {   8.3509,  4.6528,   0.3832 },
  {  11.3570,  4.6605,   0.3830 },
  { -12.7565,  4.4963,   0.6696 },
  {  -9.7430,  4.4999,   0.6690 },
  {  -6.7287,  4.5033,   0.6682 },
  {  -3.7149,  4.5060,   0.6673 },
  {  -0.7003,  4.5088,   0.6666 },
  {   2.3141,  4.5118,   0.6660 },
  {   5.3289,  4.5148,   0.6654 },
  {   8.3468,  4.5189,   0.6647 },
  {  11.3617,  4.5220,   0.6640 },
  { -12.7556,  4.3151,   0.9623 },
  {  -9.7417,  4.3179,   0.9618 },
  {  -6.7263,  4.3218,   0.9607 },
  {  -3.7125,  4.3275,   0.9597 },
  {  -0.6986,  4.3317,   0.9589 },
  {   2.3160,  4.3362,   0.9580 },
  {   5.3302,  4.3401,   0.9571 },
  {   8.3450,  4.3443,   0.9561 },
  {  11.3610,  4.3486,   0.9550 },
  { -12.7481,  4.1264,   1.2683 },
  {  -9.7344,  4.1259,   1.2671 },
  {  -6.7190,  4.1276,   1.2657 },
  {  -3.7052,  4.1299,   1.2644 },
  {  -0.6912,  4.1349,   1.2631 },
  {   2.3227,  4.1386,   1.2617 },
  {   5.3376,  4.1419,   1.2603 },
  {   8.3527,  4.1468,   1.2590 },
  {  11.3674,  4.1521,   1.2576 },
  { -12.6997,  3.9562,   1.5803 },
  {  -9.6833,  3.9579,   1.5801 },
  {  -6.6689,  3.9601,   1.5793 },
  {  -3.6551,  3.9603,   1.5786 },
  {  -0.6413,  3.9608,   1.5778 },
  {   2.3715,  3.9592,   1.5769 },
  {   5.3857,  3.9588,   1.5763 },
  {   8.3988,  3.9577,   1.5758 },
  {  11.4131,  3.9588,   1.5752 },
  { -12.6996,  3.7638,   1.9119 },
  {  -9.6959,  3.7835,   1.9112 },
  {  -6.6771,  3.7886,   1.9111 },
  {  -3.6627,  3.7910,   1.9105 },
  {  -0.6466,  3.7932,   1.9097 },
  {   2.3697,  3.7942,   1.9091 },
  {   5.3857,  3.7937,   1.9082 },
  {   8.4014,  3.7947,   1.9075 },
  {  11.4149,  3.7954,   1.9067 },
  { -12.7075,  3.6410,   2.2559 },
  {  -9.6904,  3.6397,   2.2550 },
  {  -6.6749,  3.6402,   2.2543 },
  {  -3.6589,  3.6421,   2.2540 },
  {  -0.6428,  3.6433,   2.2538 },
  {   2.3732,  3.6432,   2.2536 },
  {   5.3888,  3.6416,   2.2533 },
  {   8.4047,  3.6413,   2.2528 },
  {  11.4183,  3.6412,   2.2523 },
  { -12.7122,  3.5393,   2.6145 },
  {  -9.6969,  3.5431,   2.6143 },
  {  -6.6805,  3.5441,   2.6144 },
  {  -3.6626,  3.5462,   2.6144 },
  {  -0.6464,  3.5442,   2.6141 },
  {   2.3701,  3.5424,   2.6139 },
  {   5.3864,  3.5413,   2.6139 },
  {   8.4023,  3.5388,   2.6137 },
  {  11.4154,  3.5380,   2.6137 },
  { -12.7210,  3.4983,   2.9784 },
  {  -9.7026,  3.4965,   2.9785 },
  {  -6.6848,  3.4968,   2.9788 },
  {  -3.6650,  3.4976,   2.9789 },
  {  -0.6473,  3.4988,   2.9787 },
  {   2.3701,  3.4998,   2.9787 },
  {   5.3864,  3.5001,   2.9786 },
  {   8.4024,  3.4993,   2.9782 },
  {  11.4154,  3.4978,   2.9780 },
  { -12.6902,  3.5732,  -2.9396 },
  {  -9.6739,  3.5693,  -2.9395 },
  {  -6.6587,  3.5667,  -2.9394 },
  {  -3.6438,  3.5635,  -2.9391 },
  {  -0.6289,  3.5616,  -2.9388 },
  {   2.3860,  3.5581,  -2.9384 },
  {   5.4007,  3.5539,  -2.9384 },
  {   8.4163,  3.5520,  -2.9384 },
  {  11.4305,  3.5497,  -2.9387 },
  { -12.6897,  3.6382,  -2.5829 },
  {  -9.6731,  3.6375,  -2.5826 },
  {  -6.6578,  3.6368,  -2.5825 },
  {  -3.6418,  3.6337,  -2.5823 },
  {  -0.6270,  3.6324,  -2.5820 },
  {   2.3882,  3.6318,  -2.5815 },
  {   5.4021,  3.6301,  -2.5809 },
  {   8.4181,  3.6302,  -2.5802 },
  {  11.4331,  3.6288,  -2.5798 },
  { -12.6803,  3.7489,  -2.2370 },
  {  -9.6686,  3.7495,  -2.2366 },
  {  -6.6526,  3.7487,  -2.2361 },
  {  -3.6373,  3.7444,  -2.2354 },
  {  -0.6203,  3.7433,  -2.2345 },
  {   2.3955,  3.7439,  -2.2336 },
  {   5.4106,  3.7455,  -2.2327 },
  {   8.4249,  3.7479,  -2.2322 },
  {  11.4399,  3.7489,  -2.2316 },
  { -12.6819,  3.8867,  -1.9054 },
  {  -9.6624,  3.8802,  -1.9046 },
  {  -6.6455,  3.8782,  -1.9038 },
  {  -3.6295,  3.8788,  -1.9026 },
  {  -0.6114,  3.8805,  -1.9017 },
  {   2.4039,  3.8834,  -1.9005 },
  {   5.4195,  3.8886,  -1.8995 },
  {   8.4331,  3.8939,  -1.8987 },
  {  11.4483,  3.8975,  -1.8979 },
  { -12.6249,  4.1227,  -1.5895 },
  {  -9.6950,  4.1437,  -1.5879 },
  {  -6.6789,  4.1420,  -1.5874 },
  {  -3.6628,  4.1431,  -1.5865 },
  {  -0.6474,  4.1462,  -1.5855 },
  {   2.3703,  4.1510,  -1.5844 },
  {   5.3874,  4.1549,  -1.5834 },
  {   8.4036,  4.1588,  -1.5826 },
  {  11.4184,  4.1633,  -1.5820 },
  { -12.7498,  4.3428,  -1.2796 },
  {  -9.7358,  4.3412,  -1.2787 },
  {  -6.7209,  4.3404,  -1.2775 },
  {  -3.7051,  4.3385,  -1.2762 },
  {  -0.6899,  4.3394,  -1.2751 },
  {   2.3270,  4.3386,  -1.2739 },
  {   5.3406,  4.3424,  -1.2730 },
  {   8.3546,  4.3442,  -1.2722 },
  {  11.3705,  4.3489,  -1.2715 },
  { -12.7668,  4.4981,  -0.9899 },
  {  -9.7536,  4.5000,  -0.9890 },
  {  -6.7379,  4.5023,  -0.9880 },
  {  -3.7222,  4.5034,  -0.9869 },
  {  -0.7062,  4.5055,  -0.9860 },
  {   2.3096,  4.5088,  -0.9850 },
  {   5.3247,  4.5098,  -0.9841 },
  {   8.3411,  4.5129,  -0.9830 },
  {  11.3571,  4.5154,  -0.9821 },
  { -12.7721,  4.6151,  -0.7071 },
  {  -9.7572,  4.6174,  -0.7062 },
  {  -6.7419,  4.6208,  -0.7054 },
  {  -3.7265,  4.6256,  -0.7045 },
  {  -0.7094,  4.6282,  -0.7038 },
  {   2.3062,  4.6310,  -0.7029 },
  {   5.3225,  4.6343,  -0.7023 },
  {   8.3382,  4.6368,  -0.7017 },
  {  11.3555,  4.6404,  -0.7011 },
  { -12.7835,  4.6822,  -0.4300 },
  {  -9.7689,  4.6833,  -0.4293 },
  {  -6.7522,  4.6857,  -0.4288 },
  {  -3.7367,  4.6897,  -0.4281 },
  {  -0.7207,  4.6909,  -0.4276 },
  {   2.2970,  4.6949,  -0.4269 },
  {   5.3148,  4.6992,  -0.4263 },
  {   8.3318,  4.7026,  -0.4259 },
  {  11.3487,  4.7085,  -0.4254 },
  { -12.7963,  4.6970,  -0.1548 },
  {  -9.7795,  4.6991,  -0.1545 },
  {  -6.7635,  4.7023,  -0.1542 },
  {  -3.7477,  4.7055,  -0.1537 },
  {  -0.7297,  4.7095,  -0.1532 },
  {   2.2875,  4.7128,  -0.1527 },
  {   5.3065,  4.7176,  -0.1522 },
  {   8.3249,  4.7208,  -0.1517 },
  {  11.3417,  4.7238,  -0.1513 },

  // add 8 fake ones for the telescope
  {  -9.7237,  3.1881,  -0.2398 },
  {  -6.7092,  3.1833,  -0.2389 },
  {  -3.6945,  3.1800,  -0.2376 },
  {  -0.6796,  3.1748,  -0.2359 },
  {   2.3362,  3.1716,  -0.2339 },
  {   5.3497,  3.1676,  -0.2322 },
  {   8.3634,  3.1641,  -0.2311 },
  {  11.3775,  3.1623,  -0.2302 }
};

struct phitilt_t {
  sincos_t cosphi;
  sincos_t sinphi;
};

const phitilt_t phiTilts[] = {
  { 0.97308189, 0.23045963 },
  { 0.95668868, 0.29111298 },
  { 0.95612798, 0.29294929 }
};


constexpr int NUM_CHIPS_PER_STAVE = 9;

// bcid is used to indicate that it's the end of the bcid
void getCoords(ap_uint<1> bcid, ap_uint<2> layer, ap_uint<5> stave, ap_uint<4> chip,
               ap_ufixed<11, 10> col, ap_ufixed<10,9> row, ap_uint<4> nConstituents, out_t& outval) {

#pragma HLS pipeline
#pragma HLS AGGREGATE variable=outval compact=bit
#pragma HLS interface mode=ap_none port=outval

  const ap_ufixed<8, -7> pix_phi = 0.002688;
  const ap_ufixed<8, -7> pix_z = 0.002924;

  auto delrow = (row - 255) * pix_phi;

  std::cout << "delrow = " << delrow << std::endl;

  coords_t coords;
  if (bcid == 0) {
    if (layer == 0) {
      coords = mapL0[stave*NUM_CHIPS_PER_STAVE + chip];
    } else if (layer == 1) {
      coords = mapL1[stave*NUM_CHIPS_PER_STAVE + chip];
    } else {
      coords = mapL2[stave*NUM_CHIPS_PER_STAVE + chip];
    }
  }
  auto phitilt = (bcid == 0) ? phiTilts[layer] : phitilt_t{0, 0};

  // using order 2 Taylor expansion

  ap_ufixed<1, 0> half = 0.5;
  ap_uint<1> one = 1;
  std::cout << "coords.r = " << coords.r << std::endl;
  auto r_inv = one / coords.r;
  std::cout << "r_inv = " << r_inv << std::endl; 

  std::cout << "delphipart = "<< delrow * delrow << std::endl;
  std::cout << "delphi2 = "<< delrow * delrow * phitilt.sinphi * phitilt.cosphi * r_inv * r_inv << std::endl;
  std::cout << "delr2 = "<< delrow * delrow * phitilt.sinphi * phitilt.cosphi * r_inv * r_inv * half << std::endl;

  outval.z = coords.z + (col - 511) * pix_z;
  outval.phi = coords.phi + delrow * phitilt.cosphi * r_inv
    + delrow * delrow * phitilt.sinphi * phitilt.cosphi * r_inv * r_inv;
  outval.r = coords.r - delrow * phitilt.sinphi + delrow * delrow * phitilt.cosphi * phitilt.cosphi * r_inv * half;
  outval.nConst_or_chipid = (bcid == 0) ? nConstituents : chip;
  outval.bcid = bcid;
}
